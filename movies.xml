<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<!-- Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *	
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License
-->
	<ModulePrefs title="Hangout Starter">
		<Require feature="rpc" />
		<Require feature="views" />
		<Require feature="locked-domain" />
	</ModulePrefs>
	<Content type="html"><![CDATA[     

<html>
<script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="zyys2sz808tigvj"></script>
<style type="text/css">
<!--
body {
  background-color: #e8e8e8;
}
#main {
    margin: 0 auto;
    width: 700px;
}
#main #movie {
    display: none;
    margin-top: 5px;
}
#main #selection {
    display: block;
    margin-top: 5px;
}
#main #back {
    display: none;
    margin-top: 5px;
}

.button {
  border-radius: 3px;
  -moz-border-radius: 3px;
  background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ddd));
  background: -moz-linear-gradient(top, #fff, #ddd);  
  border: 1px solid #bbb;
}

.button:active {
	background: -webkit-gradient(linear, left top, left bottom, from(#aaa), to(#333)); 
	background: -moz-linear-gradient(bottom, #ddd, #aaa); }

-->
</style>
<script type='text/javascript'>

    function add_button() {
        var button = Dropbox.createChooseButton(options);
        document.getElementById("selection").appendChild(button);
    }

    function vpause() {
        gapi.hangout.data.submitDelta( {"action": "media_change", "state": "pause"} );
    }
    function vplay() {
        gapi.hangout.data.submitDelta( {"action": "media_change", "state": "play"} );
    }
    function add_movie(link) {
        var src = "<video id='vidplayer' width='640' height='360' controls onpause='javascript:vpause();' onplay='javascript:vplay();'><source src='"+ link +"' type='video/mp4'></video>";
        movie.innerHTML = src;
        toggleMovie('movie');
    }
    function toggleMovie(arg) {
        var movie = document.getElementById('movie');
        var back = document.getElementById('back');
        var selection = document.getElementById('selection');
        if (arg == "movie") {
            movie.style.display = "block";
            back.style.display = "block";
            selection.style.display = "none";
        } else {
            movie.style.display = "none";
            movie.innerHTML = "";
            back.style.display = "none";
            selection.style.display = "block";
            gapi.hangout.data.submitDelta( {"action": "go_back"} );
        }
    }
    gapi.hangout.data.onStateChanged.add( function(event) {
        var state = gapi.hangout.data.getState();
        if (state['action'] == "media_change") {
            if (state['state'] == "play") {
                document.getElementById('vidplayer').play();
            } else {
                document.getElementById('vidplayer').pause();
            }
        } else if(state['action'] == "add_movie") {
            add_movie(state['link']);
        } else if(state['action'] == "go_back") {
            toggleMovie('selection');
        }
    } );

    options = {
        success: function(files) {
            gapi.hangout.data.submitDelta( {"action": "add_movie", "link": files[0].link} );
        },
        cancel: function() {},
        linkType: "direct", // or "direct"
        multiselect: false, // or true
        extensions: ['.mp4', '.avi', '.wmv', '.mpeg', '.py'],
    };

    file = {
        name: "filename.txt",
        link: "https://...",
        bytes: 464,
        icon: "https://...",
        thumbnailLink: "https://...?bounding_box=75&mode=fit",
    };

</script>
<body onPageLoad="javascript:add_button();">
    <div id='main'>
        <div id='selection'>
            <font color='#181818' size='7'>Movies <b>with Friends</b></font><br>
            <font color='#181818'>Watch movies with your friends through G+ Hangouts and Dropbox.</font><br><br>
            <font color="#181818"><b>Step one: </b> pick a movie!</font><br>
        </div>
        <div id='back'>
            <a href='#' onclick="javascript:toggleMovie('selection');">Return to main page</a>
        </div>
        <div id='movie'></div>
    </div>
</body>
]]>
</Content>
</Module>

