<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<!-- Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *	
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License
-->
	<ModulePrefs title="Hangout Starter">
		<Require feature="rpc" />
		<Require feature="views" />
		<Require feature="locked-domain" />
	</ModulePrefs>
	<Content type="html"><![CDATA[     

<html>
<script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="zyys2sz808tigvj"></script>
<style type="text/css">
<!--
body {
  background-color: #e8e8e8;
}
#main {
    margin: 0 auto;
    width: 700px;
}
#main #movie {
    display: none;
}
.button {
  border-radius: 3px;
  -moz-border-radius: 3px;
  background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ddd));
  background: -moz-linear-gradient(top, #fff, #ddd);  
  border: 1px solid #bbb;
}

.button:active {
	background: -webkit-gradient(linear, left top, left bottom, from(#aaa), to(#333)); 
	background: -moz-linear-gradient(bottom, #ddd, #aaa); }

-->
</style>
<body>
<div id='main'>
<font color='#181818' size='7'>Movies <b>with Friends</b></font><br>
<font color='#181818'>Watch movies with your friends through G+ Hangouts and Dropbox.</font><br><br>
<font color="#181818">Choose the movie!</font><br>
<script type='text/javascript'>

    function vpause() {
        gapi.hangout.data.submitDelta( {"state": "pause", "media_change": "true"} );
    }
    function vplay() {
        gapi.hangout.data.submitDelta( {"state": "play", "media_change": "true"} );
    }

    gapi.hangout.data.onStateChanged.add( function(event) {
        var state = gapi.hangout.data.getState();
        if (state['media_change'] == "true") {
            if (state['state'] == "play") {
                document.getElementById('vidplayer').play();
            } else {
                document.getElementById('vidplayer').pause();
            }
        } else {
            document.getElementById('movie').style.display = state['display'];
            var l = state['link'];
            var src = "<video id='vidplayer' width='640' height='360' controls onpause='javascript:vpause();' onplay='javascript:vplay();'>";
            src += "<source src='"+ l +"' type='video/mp4'>";
            src += "</video>"
            src += "<br>"+l;
            document.getElementById('movie').innerHTML = src;
        }
    } );
  options = {

    // Required. Called when a user selects an item in the Chooser.
    success: function(files) {
        document.getElementById('movie').style.display = "block";
        var l = files[0].link;
        var src = "<video id='vidplayer' width='640' height='360' controls onpause='javascript:vpause();' onplay='javascript:vplay();'>";
        src += "<source src='"+ l +"' type='video/mp4'>";
        src += "</video>";
        src += "<br>"+l;
        document.getElementById('movie').innerHTML = src;
        gapi.hangout.data.submitDelta( {"display": "block", "link": l, "media_change": "false"} );
    },

    // Optional. Called when the user closes the dialog without selecting a file
    // and does not include any parameters.
    cancel: function() {

    },

    // Optional. "preview" (default) is a preview link to the document for sharing,
    // "direct" is an expiring link to download the contents of the file. For more
    // information about link types, see Link types below.
    linkType: "direct", // or "direct"

    // Optional. A value of false (default) limits selection to a single file, while
    // true enables multiple file selection.
    multiselect: false, // or true

    // Optional. This is a list of file extensions. If specified, the user will
    // only be able to select files with these extensions. You may also specify
    // file types, such as "video" or "images" in the list. For more information,
    // see File types below. By default, all extensions are allowed.
    extensions: ['.mp4', '.avi', '.wmv', '.mpeg', '.py'],
};

file = {

    // Name of the file.
    name: "filename.txt",

    // URL to access the file, which varies depending on the linkType specified when the
    // Chooser was triggered.
    link: "https://...",

    // Size of the file in bytes.
    bytes: 464,

    // URL to a 64x64px icon for the file based on the file's extension.
    icon: "https://...",

    // A thumbnail URL generated when the user selects images and videos.
    // If the user didn't select an image or video, no thumbnail will be included.
    thumbnailLink: "https://...?bounding_box=75&mode=fit",
};

</script>
<input type='button' class="button" id='dp-chooser' onclick="javascript:Dropbox.choose(options);" value="Choose a movie!" />

<div id='movie'></div>
</div>
</body>
]]>
</Content>
</Module>

